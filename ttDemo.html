<meta charset="utf-8">
<head>
<title>computing place:: topotime alpha0.1</title>
	<link rel="stylesheet" href="css/pepper-grinder/jquery-ui-1.8.23.custom.css" />
	<script src="https://code.jquery.com/jquery-1.9.1.js"></script>
	<script src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script src="http://d3js.org/d3.v3.js"></script>
	<script src="js/ttdemo.js"></script>
	<!--<script src="data/out_geom_d3.json"></script>
	<script src="data/polys.js"></script>-->
</head>
<body>
<h3 id="title"></h3>
<div class="ui-widget">
<select id="sel_case">
	<option value="ttspec_geom_d3">topotime spec</option>
	<option value="ww2_geom_d3" selected="selected">WW II scenario</option>
	<option value="dance_geom_d3">George Dance the Younger</option>
	<option value="pleiades_fuzz98_geom_d3">Pleiades periods</option>
</select>
</div>
<div id="geomvis"></div>
<div id="timeline"></div>
<script>
var ttPolys
dataFile = $("#sel_case").val()
dataLabel=$("#sel_case option:selected").text();
$("#title").html(dataLabel)
updateData = function(d) {
	d3.select("svg").remove()
    d3.json("data/"+d+".json", function(error, json){
	    if (error) {
			alert('that data isn\'t available')
		}
	    ttgeom = json;
	    displayGeometry(ttgeom)
    })
}
d3.json("data/"+dataFile+".json", function(error, json){
	if (error) return console.warn(error);
	//ttPolys = json;
	displayGeometry(json)
	console.log('got some data, how\'s it look?');
})
displayGeometry = function(ttPolys) {
	minx=d3.min(ttPolys, function(d,i) {
		return d3.min(d.points, function(p) {return p.x})})
	maxx=d3.max(ttPolys, function(d,i) {
		return d3.max(d.points, function(p) {return p.x})})
	var vis = d3.select("#geomvis").append("svg")
         .attr("width", 900)
         .attr("height", 400) ;

	scaleX = d3.scale.linear()
        //.domain([2.4299095, 2.4325505])
		.domain([minx,maxx])
        .range([10,700]);
	
	scaleY = d3.scale.linear()
        .domain([0,1])
        .range([300,200]);

	color = d3.scale.category10();

	vis.selectAll("polygon")
    //.data(arrayOfPolygons)
    .data(ttPolys)
    //.data(tt3)
  .enter().append("polygon")
    .attr("points",function(d) { 
        return d.points.map(function(d) { return [scaleX(d.x),scaleY(d.y)].join(","); }).join(" ");})
    .attr("fill", function(d){return color(d.label)})
    .attr("stroke", function(d){return color(d.label)})
    .attr("stroke-width",2)
    .attr("opacity",0.2);

	// add legend   
	var legend = vis.append("g")
	.attr("class", "legend")
	//.attr("x", w - 65)
	//.attr("y", 50)
	.attr("height", 100)
	.attr("width", 100)
	.attr('transform', 'translate(10,20)');
          
    legend 
	.selectAll('rect')
	.data(ttPolys)
	.enter()
	.append("rect")
	    .attr("x", 40)
	.attr("y", function(d, i){ return i *  20;})
	    .attr("width", 10)
	    .attr("height", 10)
	    .style("fill", function(d) { return color(d.label);})
	    .attr("opacity",0.4);
      
    legend.selectAll('text')
	//.data(arrayOfPolygons)
	.data(ttPolys)
	//.data(tt3)
	.enter()
	.append("text")
	    .attr("x", 60)
	.attr("y", function(d, i){ return i *  20 + 9;})
	    .text(function(d) {return d.label});
}
//displayGeometry(dataFile)
</script>
</body>
</html>